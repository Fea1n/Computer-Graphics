## P1  SplitSum

默认光线来自无穷远处 为distant lighting 

环境光照又称Image-Base Lighting (IBL)

<img src="D:\Git_Repo\GAMES_CG\00_Basis\01_高质量实时渲染\02_SUM\P2 实时环境光照.assets\image-20220606235223669.png" alt="image-20220606235223669" style="zoom: 33%;" />

使用蒙特卡洛近似 计算光线公式， 近似

注释：近年来采样的实现愈加火热

### 光线分布

BRDF glossy 聚焦 范围小 diffuse 范围全

<img src="D:\Git_Repo\GAMES_CG\00_Basis\01_高质量实时渲染\02_SUM\P2 实时环境光照.assets\image-20220607124029025.png" alt="image-20220607124029025" style="zoom: 33%;" />

分离出来后 积分范围 也更新为 g的范围 

视线为incident，若光线为diffuse smooth 值的变化不大

使用类似三线性插值方式 逐渐

以上使用 最终的类似normal分布 将光线filter 解决左半边的公式积分



### 菲涅尔项和法线分布

在渲染之前filter好



<img src="D:\Git_Repo\GAMES_CG\00_Basis\01_高质量实时渲染\02_SUM\P2 实时环境光照.assets\image-20220607231436201.png" alt="image-20220607231436201" style="zoom:50%;" />

微表面分布

菲涅尔项由入射光线的角度 决定光线颜色等项

roughness 粗糙度 

<img src="D:\Git_Repo\GAMES_CG\00_Basis\01_高质量实时渲染\02_SUM\P2 实时环境光照.assets\image-20220607231908376.png" alt="image-20220607231908376" style="zoom:50%;" />

菲涅尔项的分布 近似表达，基础反射率 R0 和反射角度 theta（theta 出射光线与半程向量的夹角 ）

<img src="D:\Git_Repo\GAMES_CG\00_Basis\01_高质量实时渲染\02_SUM\P2 实时环境光照.assets\image-20220607232307031.png" alt="image-20220607232307031" style="zoom:50%;" />

微表面的法线分布  类高斯分布 

a 表面的粗糙度 半程向量和法线的夹角 theta h 

核心目的 降低预计算结果的参数空间的维度

<img src="D:\Git_Repo\GAMES_CG\00_Basis\01_高质量实时渲染\02_SUM\P2 实时环境光照.assets\image-20220607233347062.png" alt="image-20220607233347062" style="zoom:50%;" />

优化 基于 Schlick 的等式 将基础反射率R0 分离出来 形成只有 粗糙度a  和 半角theta的 “表” （打表的形成的分布），因而可以存成二维的数组

<img src="D:\Git_Repo\GAMES_CG\00_Basis\01_高质量实时渲染\02_SUM\P2 实时环境光照.assets\image-20220607234204145.png" alt="image-20220607234204145" style="zoom:50%;" />

工业界 称 split sum 拆项求和 非split integral 拆项积分

没有采样 没有noise 



实时环境光照

从最亮的光源渲染，

相关工作

imperfect shadow maps

light cuts(多个小光源)

RTRT(终极解决方案，实时光追)

PRT

## P2 球面谐波函数(Spherical Harmonics(SH))

频率和滤波

傅里叶变换 在空间的频率变换

一系列的定义在球面上的二维函数，每种有不同的频率

每一阶有2n+1个基函数，前n阶有n方个基函数

求每个基函数的系数过程为投影projection，前多少阶的基函数多用，基函数有正交属性  

Diffuse BRDF的球面谐波函数不需要描述高频的信号，本身频率不会超过三阶，



MAXWELL在球坐标系的解





两行代码足矣！

## P3 Prefiltered env.lighting



## P4 Precomputed Radiance Transfer(PRT)

在PRT中 不考虑积分和求和的顺序

场景中只有lighting 发生变化

光源发生旋转 可以通过sh立即得到变换后的光照



基函数 性质

正交性

简单投影

简单旋转

简单卷积

少数基函数(低频)，简单旋转后可以被同阶基函数的线性组合表示

实际计算过程中只需要lighting 和 light transport 两部分即可计算

以上情况假设brdf为常数，解决多次bounce的问题，考虑每个点的visiability即shadow

存储开销，目前只需存储light transport 向量，



环境光照只需要光线传输一次，传输多次为全局光照





